<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>A/B Experiment Demo â€” See Your Variants</title>
  <link rel="stylesheet" href="/css/style.css">
  <style>
    .demo-page { max-width: 900px; margin: 0 auto; padding: 2rem; }
    .demo-header { margin-bottom: 2rem; }
    .demo-header h1 { font-size: 1.5rem; margin-bottom: 0.25rem; }
    .demo-header p { color: #6b7280; font-size: 0.875rem; }
    .your-variants {
      background: #f0f9ff;
      border: 1px solid #bae6fd;
      border-radius: 0.75rem;
      padding: 1rem 1.25rem;
      margin-bottom: 2rem;
      font-size: 0.875rem;
    }
    .your-variants strong { color: #0369a1; }
    .experiment-demo-section {
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 0.75rem;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    .experiment-demo-section h2 { font-size: 1.125rem; margin-bottom: 0.5rem; }
    .experiment-demo-section .variant-badge {
      display: inline-block;
      padding: 0.2rem 0.5rem;
      border-radius: 0.375rem;
      font-size: 0.75rem;
      font-weight: 600;
      margin-bottom: 1rem;
    }
    .variant-badge-a { background: #dbeafe; color: #1e40af; }
    .variant-badge-b { background: #d1fae5; color: #065f46; }
    .mockup-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.05em; color: #9ca3af; margin-bottom: 0.5rem; }
    .mockup-kpi-compact {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 0.5rem;
    }
    .mockup-kpi-compact .card {
      background: #f3f4f6;
      border-radius: 0.5rem;
      padding: 0.5rem 0.75rem;
      font-size: 0.75rem;
    }
    .mockup-kpi-compact .card .num { font-weight: 700; font-size: 1rem; }
    .mockup-kpi-expanded {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }
    .mockup-kpi-expanded .card {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 0.5rem;
      padding: 1rem 1.25rem;
    }
    .mockup-kpi-expanded .card .label { font-size: 0.75rem; color: #6b7280; }
    .mockup-kpi-expanded .card .num { font-size: 1.5rem; font-weight: 700; }
    .mockup-onboarding-minimal {
      background: #f9fafb;
      border-radius: 0.5rem;
      padding: 1rem;
      font-size: 0.875rem;
    }
    .mockup-onboarding-guided {
      background: #f9fafb;
      border-radius: 0.5rem;
      padding: 1rem;
      font-size: 0.875rem;
      position: relative;
      border: 2px solid #4f46e5;
    }
    .mockup-onboarding-guided::before {
      content: "Step 1 of 3";
      position: absolute;
      top: -0.6rem;
      left: 1rem;
      background: #4f46e5;
      color: #fff;
      font-size: 0.65rem;
      padding: 0.2rem 0.5rem;
      border-radius: 0.25rem;
    }
    .mockup-onboarding-guided .tooltip-hint { color: #4f46e5; font-size: 0.75rem; margin-top: 0.5rem; }
    .comparison-table { width: 100%; font-size: 0.8125rem; margin-top: 1rem; border-collapse: collapse; }
    .comparison-table th, .comparison-table td { padding: 0.5rem; text-align: left; border-bottom: 1px solid #e5e7eb; }
    .comparison-table th { color: #6b7280; font-weight: 500; }
    .demo-loading { text-align: center; padding: 2rem; color: #6b7280; }
    .demo-error { background: #fef2f2; border: 1px solid #fecaca; border-radius: 0.5rem; padding: 1rem; color: #991b1b; font-size: 0.875rem; }
  </style>
</head>
<body>
  <div class="demo-page">
    <div class="demo-header">
      <h1>A/B Experiment Demo</h1>
      <p>This page shows what your current A/B variants look like. Your assignment is sticky (cookie-based).</p>
    </div>

    <div id="demoLoading" class="demo-loading">Loading your variant assignmentâ€¦</div>
    <div id="demoError" class="demo-error" style="display: none;"></div>
    <div id="demoContent" style="display: none;">
      <div class="your-variants" id="yourVariantsSummary"></div>

      <div class="experiment-demo-section" style="background: #f8fafc; border-color: #cbd5e1;">
        <h2 style="margin-bottom: 0.75rem;">What kind of change each test makes</h2>
        <p style="font-size: 0.875rem; color: #64748b; margin-bottom: 1rem;">None of these change the whole page â€” each test changes a specific element or flow.</p>
        <table class="comparison-table">
          <thead><tr><th>Experiment</th><th>Type</th><th>What changes</th></tr></thead>
          <tbody>
            <tr><td><strong>kpi_scorecard_layout</strong></td><td>Layout</td><td>KPI scorecard component only (grid of metric cards). Rest of dashboard unchanged.</td></tr>
            <tr><td><strong>guided_onboarding</strong></td><td>Onboarding flow</td><td>First-use experience: minimal vs guided (step indicator + tooltips). Can span one or more screens.</td></tr>
            <tr><td><strong>pricing_cta_upgrade</strong></td><td>Button (CTA)</td><td>CTA button text on pricing page only (e.g. "Start Free Trial" vs "Get full access"). Rest of page unchanged.</td></tr>
          </tbody>
        </table>
      </div>

      <div class="experiment-demo-section" id="kpiSection">
        <h2>Experiment 1: KPI scorecard layout</h2>
        <p id="kpiVariantBadge"></p>
        <p class="mockup-label">What you're seeing (mockup)</p>
        <div id="kpiMockup"></div>
        <table class="comparison-table">
          <thead><tr><th>Variant</th><th>Description</th></tr></thead>
          <tbody>
            <tr><td><span class="variant-badge variant-badge-a">A</span> compact</td><td>Small scorecards in a tight 4-column grid; less emphasis per metric.</td></tr>
            <tr><td><span class="variant-badge variant-badge-b">B</span> expanded</td><td>Larger scorecards in a 2-column grid; more space and emphasis per KPI.</td></tr>
          </tbody>
        </table>
      </div>

      <div class="experiment-demo-section" id="onboardingSection">
        <h2>Experiment 2: Guided onboarding</h2>
        <p id="onboardingVariantBadge"></p>
        <p class="mockup-label">What you're seeing (mockup)</p>
        <div id="onboardingMockup"></div>
        <table class="comparison-table">
          <thead><tr><th>Variant</th><th>Description</th></tr></thead>
          <tbody>
            <tr><td><span class="variant-badge variant-badge-a">A</span> minimal</td><td>No step indicator or tooltips; user sees the main content only.</td></tr>
            <tr><td><span class="variant-badge variant-badge-b">B</span> guided</td><td>Step-by-step indicator (e.g. "Step 1 of 3") and tooltip hints to encourage exploration.</td></tr>
          </tbody>
        </table>
      </div>

      <div class="experiment-demo-section" id="pricingSection" style="opacity: 0.5;">
        <h2>Experiment 3: Pricing CTA (Disabled)</h2>
        <p id="pricingVariantBadge"></p>
        <p class="mockup-label" style="color: #f59e0b;">Hackathon Note</p>
        <p style="font-size: 0.875rem; color: #64748b;">Pricing experiments are disabled during the Gemini 3 Developer Challenge. This is a hackathon demo build.</p>
        <table class="comparison-table">
          <thead><tr><th>Status</th><th>Description</th></tr></thead>
          <tbody>
            <tr><td><span class="variant-badge" style="background: #374151;">N/A</span></td><td>Pricing page redirects to demo during hackathon period</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    (async function () {
      const loading = document.getElementById('demoLoading');
      const error = document.getElementById('demoError');
      const content = document.getElementById('demoContent');
      const summary = document.getElementById('yourVariantsSummary');
      const kpiBadge = document.getElementById('kpiVariantBadge');
      const kpiMockup = document.getElementById('kpiMockup');
      const onboardingBadge = document.getElementById('onboardingVariantBadge');
      const onboardingMockup = document.getElementById('onboardingMockup');
      const pricingBadge = document.getElementById('pricingVariantBadge');

      try {
        const res = await fetch('/api/experiments/dashboard', { credentials: 'include' });
        const data = await res.json();

        if (!res.ok) {
          error.textContent = data.message || data.error || 'Failed to load variant assignment.';
          error.style.display = 'block';
          loading.style.display = 'none';
          return;
        }

        loading.style.display = 'none';
        content.style.display = 'block';

        const variants = data.variants || {};
        const descriptions = data.variantDescriptions || {};

        const kpiV = variants.kpi_scorecard_layout || 'A';
        const onboardingV = variants.guided_onboarding || 'A';
        const pricingV = variants.pricing_cta_upgrade || 'A';

        summary.innerHTML = '<strong>Your current assignment:</strong> ' +
          'KPI layout = <strong>' + (descriptions.kpi_scorecard_layout?.description || (kpiV === 'A' ? 'compact' : 'expanded')) + '</strong> (Variant ' + kpiV + '), ' +
          'Onboarding = <strong>' + (descriptions.guided_onboarding?.description || (onboardingV === 'A' ? 'minimal' : 'guided')) + '</strong> (Variant ' + onboardingV + '), ' +
          'Pricing CTA = <strong>' + (descriptions.pricing_cta_upgrade?.description || (pricingV === 'A' ? 'standard_cta' : 'value_cta')) + '</strong> (Variant ' + pricingV + ').';

        kpiBadge.innerHTML = 'You are in <span class="variant-badge variant-badge-' + (kpiV === 'A' ? 'a' : 'b') + '">Variant ' + kpiV + '</span>: ' + (kpiV === 'A' ? 'compact' : 'expanded') + ' layout.';
        if (kpiV === 'A') {
          kpiMockup.innerHTML = '<div class="mockup-kpi-compact">' +
            '<div class="card"><span class="num">12.5k</span><br>Impressions</div>' +
            '<div class="card"><span class="num">340</span><br>Clicks</div>' +
            '<div class="card"><span class="num">2.7%</span><br>CTR</div>' +
            '<div class="card"><span class="num">$89</span><br>Spend</div>' +
            '</div>';
        } else {
          kpiMockup.innerHTML = '<div class="mockup-kpi-expanded">' +
            '<div class="card"><div class="label">Impressions</div><div class="num">12,500</div></div>' +
            '<div class="card"><div class="label">Clicks</div><div class="num">340</div></div>' +
            '<div class="card"><div class="label">CTR</div><div class="num">2.7%</div></div>' +
            '<div class="card"><div class="label">Spend</div><div class="num">$89</div></div>' +
            '</div>';
        }

        onboardingBadge.innerHTML = 'You are in <span class="variant-badge variant-badge-' + (onboardingV === 'A' ? 'a' : 'b') + '">Variant ' + onboardingV + '</span>: ' + (onboardingV === 'A' ? 'minimal' : 'guided') + ' onboarding.';
        if (onboardingV === 'A') {
          onboardingMockup.innerHTML = '<div class="mockup-onboarding-minimal">Welcome to the dashboard. Use the sidebar to switch workspaces and connect data sources.</div>';
        } else {
          onboardingMockup.innerHTML = '<div class="mockup-onboarding-guided">Welcome to the dashboard. Use the sidebar to switch workspaces and connect data sources.<div class="tooltip-hint">ðŸ’¡ Tip: Click "Connect" to add your first data source.</div></div>';
        }

        pricingBadge.innerHTML = 'You are in <span class="variant-badge variant-badge-' + (pricingV === 'A' ? 'a' : 'b') + '">Variant ' + pricingV + '</span>: ' + (pricingV === 'A' ? 'standard_cta' : 'value_cta') + ' (button text on /pricing).';
      } catch (e) {
        loading.style.display = 'none';
        error.textContent = 'Could not load variant assignment: ' + e.message;
        error.style.display = 'block';
      }
    })();
  </script>
</body>
</html>
